# 🏥 健康達人積分賽 - 儀表板系統

> 活動期間：2025/08/08 - 2025/10/31
> 總獎金超過 30,000 元！

## 📋 目錄

- [專案簡介](#專案簡介)
- [功能特色](#功能特色)
- [快速開始](#快速開始)
- [資料更新流程](#資料更新流程)
- [專案結構](#專案結構)
- [資料格式說明](#資料格式說明)
- [常見問題](#常見問題)

---

## 📊 專案簡介

這是一個為「健康達人積分賽」設計的即時排行榜儀表板系統，採用 **3-Layer 模組化架構**，支援：
- ✅ 男女分組排名（自動獎金計算）
- ✅ 個人成績查詢與活動明細
- ✅ 四大活動類別統計分析
- ✅ 視覺化統計圖表
- ✅ 自動化資料處理流程

---

## ✨ 功能特色

### 1. 📊 總覽頁
- **關鍵指標卡片**：
  - 實際參與人數（含性別分布）
  - 最高/平均/最低分數
- **活動參與統計**：
  - 🏃 日常運動次數與參與人數
  - 🍎 健康飲食次數與參與人數
  - ⭐ 額外加分次數與參與人數
  - 🎯 社團活動次數與參與人數
- **男女組 Top 10 排行榜**快速預覽

### 2. 🌸 女性組完整排名
- 完整排名列表（前28名可獲獎金）
- 支援姓名搜尋與部門篩選
- 顯示排名、獎牌、總分、獎金資訊
- 獎金條件：排名前28名 **且** 總分≥200分

### 3. 💪 男性組完整排名
- 完整排名列表（前14名可獲獎金）
- 相同功能與女性組
- 獎金條件：排名前14名 **且** 總分≥200分

### 4. 🔍 個人查詢
- **基本資訊**：姓名、性別、部門、排名、總分
- **獎金資訊**：獎金金額、獎牌等級、衝刺建議
- **活動統計**：
  - 日常運動：總次數與得分
  - 健康飲食：總次數與得分
  - 額外加分：總次數與得分
  - 社團活動：總次數與得分
- **社團活動明細表**：
  - 依日期排序的參與記錄
  - 累計得分趨勢圖（Stacked Area Chart）
  - X軸從2025/8/8開始
  - Hover顯示活動名稱與得分

### 5. 📈 統計圖表
- **活動參與統計**：
  - 活動次數分布圓餅圖
  - 活動分數分布圓餅圖
- **各部門參與度**：男女分組長條圖
- **分數分段統計**：分數區間分布圖

### 6. 📝 活動簡介
- 活動說明與參加辦法
- 獎金結構與條件說明

---

## 🚀 快速開始

### 環境需求

- Python 3.8 或以上
- pip（Python 套件管理工具）

### 安裝步驟

1. **安裝 Python 套件**

```bash
pip install -r requirements.txt
```

2. **確認資料檔案位置**

確保以下檔案存在於正確位置：
- `data/每周分數累積.xlsx`（主要資料來源）
- `data/參加者活動統計表.xlsx`（自動生成）

3. **啟動儀表板**

```bash
# Windows 用戶：雙擊執行
scripts\run_local.bat

# 或手動執行
cd src
streamlit run dashboard.py
```

4. **開啟瀏覽器**

自動開啟 http://localhost:8501

---

## 🔄 資料更新流程

### 自動化處理流程

系統採用 **單一資料來源** 設計：

1. **編輯主檔案**：`data/每周分數累積.xlsx`
2. **執行資料處理**：
   ```bash
   cd src
   python new_data_processor.py
   ```
3. **自動生成統計表**：`data/參加者活動統計表.xlsx`
4. **儀表板自動載入**：點擊「🔄 重新載入」或重啟應用

### 雲端部署更新（Streamlit Cloud）

1. **更新 Excel 檔案**：
   ```bash
   # 方法1：使用更新腳本（Windows）
   scripts\update_data.bat

   # 方法2：手動提交
   git add data/每周分數累積.xlsx data/參加者活動統計表.xlsx
   git commit -m "更新分數資料"
   git push origin main
   ```

2. **自動部署**：
   - Streamlit Cloud 自動偵測更新
   - 約 1-2 分鐘後生效

---

## 📁 專案結構

```
HealthMaster/
│
├── src/                                    # 程式碼目錄
│   ├── dashboard.py                        # 主儀表板（Presentation Layer）
│   ├── data_loader.py                      # 資料載入器（Data Layer）
│   ├── ranking_engine.py                   # 排名計算引擎（Business Logic）
│   ├── new_data_processor.py               # 新資料處理器
│   ├── new_activity_analyzer.py            # 活動分析器
│   └── [其他輔助模組]
│
├── data/                                   # 資料目錄
│   ├── 每周分數累積.xlsx                    # 主要資料來源 ⭐
│   └── 參加者活動統計表.xlsx                # 自動生成的統計表
│
├── scripts/                                # 工具腳本
│   ├── update_data.bat                     # Windows 更新腳本
│   ├── update_data.sh                      # Mac/Linux 更新腳本
│   └── run_local.bat                       # 本地測試腳本
│
├── .streamlit/                             # Streamlit 設定
│   └── config.toml                         # 主題與設定
│
├── app.py                                  # Streamlit Cloud 入口文件
├── requirements.txt                        # Python 套件清單
├── CLAUDE.md                               # 開發文檔（給 AI 助手）
├── README.md                               # 本說明檔案
└── 活動簡介.txt                            # 活動介紹
```

---

## 📋 資料格式說明

### Excel 檔案結構：`data/每周分數累積.xlsx`

#### 工作表說明

1. **總表** - 彙整各回合分數
   - Key: `id`
   - 用途：匯總顯示

2. **期間工作表**（0808-0830、0831-0921 等）
   - Key: `id`
   - 欄位結構：
     - **L欄**：日常運動得分（次數 = 得分 ÷ 10）
     - **M欄**：飲食得分（次數 = 得分 ÷ 10）
     - **N欄**：個人Bonus得分（次數 = 得分 ÷ 30）
     - **O欄~total前**：社團活動得分
       - 欄位名稱格式：`日期 活動名稱`（例：`8/13 羽球社`）
       - 特殊活動：`人資講座` → 日期自動設為 `2025/8/8`

3. **帳號整理** - 參加者基本資料
   - Key: `帳號(最新8/8)2`
   - 重要欄位：
     - `性別`：顯示時自動移除「生理」前綴
     - `所屬部門`：用於部門統計

### 資料處理邏輯

#### A. 分數計算
```
日常運動次數 = 日常運動得分 ÷ 10
飲食次數 = 飲食得分 ÷ 10
個人Bonus次數 = 個人Bonus得分 ÷ 30
社團活動 = 有分數即表示參加
```

#### B. 社團活動處理（Wide to Long）
1. 解析欄位名稱取得日期與活動名稱
2. 轉換日期格式（預設年份：2025）
3. 範例：
   - `8/13 羽球社` → 日期：`2025/08/13`，活動：`羽球社`
   - `人資講座` → 日期：`2025/08/08`，活動：`人資講座`

#### C. 參加者活動統計表
最終輸出欄位：
- id, 姓名, 性別, 所屬部門
- 運動總得分, 運動總次數
- 飲食總得分, 飲食總次數
- Bonus總得分, Bonus總次數
- 社團總得分, 社團總次數
- total, 期間1分數, 期間2分數

### 資料驗證範例

以莊依靜為例：
- 期間1 (0808-0830): 820分 ✓
- 期間2 (0831-0921): 1540分 ✓
- 總分: 2360分 ✓

---

## 🎁 獎金規則

### 男子組（前14名）
| 排名 | 獎金 |
|------|------|
| 🥇 第1名 | NT$6,000 |
| 🥈 第2-4名 | 各 NT$3,000 |
| 🥉 第5-9名 | 各 NT$2,000 |
| 🏅 第10-14名 | 各 NT$1,000 |

### 女子組（前28名）
| 排名 | 獎金 |
|------|------|
| 🥇 第1-2名 | 各 NT$6,000 |
| 🥈 第3-8名 | 各 NT$3,000 |
| 🥉 第9-18名 | 各 NT$2,000 |
| 🏅 第19-28名 | 各 NT$1,000 |

### ⚠️ 重要條件
**總分必須 ≥ 200分 才能獲得獎金！**

---

## ❓ 常見問題

### Q1：如何重新生成參加者活動統計表？

**A：** 執行資料處理程式
```bash
cd src
python new_data_processor.py
```

### Q2：社團活動日期如何設定？

**A：**
- 有日期格式的欄位：自動解析（例：`8/13 羽球社`）
- 無日期格式的欄位：
  - `人資講座` → 固定為 `2025/8/8`
  - 其他 → 使用期間中間日期

### Q3：為什麼部門統計出現錯誤？

**A：** 確保資料中沒有 id=0 或姓名=0 的無效記錄。系統會自動過濾這些資料。

### Q4：如何新增新的期間工作表？

**A：**
1. 在 Excel 新增期間工作表（例：`0922-1015`）
2. 更新 `new_data_processor.py` 中的 `load_period_data()` 調用
3. 重新執行資料處理

### Q5：儀表板數字不正確怎麼辦？

**A：**
1. 檢查 Excel 檔案是否有誤
2. 重新生成統計表：`python new_data_processor.py`
3. 點擊儀表板「🔄 重新載入」

### Q6：如何修改性別顯示？

**A：** 系統會自動處理：
- `生理女` → `女`
- `生理男` → `男`

---

## 🔧 技術架構

### 3-Layer 模組化設計

1. **Data Layer** (`data_loader.py`)
   - 載入 Excel 檔案
   - ID-based 資料整合
   - 資料驗證與清理
   - 5分鐘快取機制

2. **Business Logic** (`ranking_engine.py`)
   - 性別分組排名計算
   - 獎金自動分配
   - 個人分數分析

3. **Presentation Layer** (`dashboard.py`)
   - Streamlit 介面
   - 互動式圖表（Plotly）
   - 即時搜尋與篩選

### 資料流程

```
每周分數累積.xlsx
    ↓
new_data_processor.py (處理)
    ↓
參加者活動統計表.xlsx
    ↓
data_loader.py (載入)
    ↓
dashboard.py (顯示)
```

---

## 📞 技術支援

如有問題，請檢查：
1. Python 版本（需 3.8+）
2. 套件是否正確安裝：`pip install -r requirements.txt`
3. Excel 檔案格式是否符合規範
4. 執行 `python new_data_processor.py` 是否成功

---

## 🎉 致謝

感謝所有參與健康達人積分賽的夥伴們！
讓我們一起養成健康生活習慣，達成理想體態目標！💪

---

**最後更新：** 2025/10/09
**版本：** 3.0.0 - 單一資料來源架構
**技術棧：** Python 3.9+ | Streamlit | Pandas | Plotly
**授權：** MIT License
